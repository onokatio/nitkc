割り込みによるLED制御実験
===

# 1. 目的

割り込みによるキー入力処理とPWM制御を実現することを通じて、効果的な割り込み処理の方法を修得する。

# 2. 実験原理

省略

# 3. 使用機器

- H8ワンボードマイコン、USBケーブル
- パーソナルコンピュータ
- オシロスコープ、ディジタルマルチメータ
- ブレッドボード、抵抗器

# 4. 実験方法

省略

# 5. 実験結果

## 5.1 LEDのPWM制御

PWM値を指定したところ、LEDがPWM値の通りのデューティー比で動作した。
図1.1に各LEDの電圧を示す。

## 5.2 キー入力処理の追加

2キーと5キーで赤LED、3キーと6キーで緑LEDのPWM値を制御することができた。
各キーを押すたびに、実験方法の通りPWM値の増加、減少が変化した。

図1.2に各LEDの電圧を示す。

## 5.3 A/D変換サンプリング処理の追加

AN1とAN2に電圧を加えたところ、PWM値が変化した。

図1.3に各LEDの電圧を示す。

# 6. 検討課題

## 1. LEDのPWM 制御について,最初から定義されている値を使う時、割り込み周期と制御周期の値と制御値(PWM値)の範囲を答えよ。また、割り込み周期を変えずに制御値の範囲を変更するとき、制御周期がどのように変化するか、説明しなさい。

- 割り込み周期は1[ms]
- 制御周期は10[ms]
- 制御値: 赤LED 30[ms]
- 制御値: 緑LED 50[ms]

割り込み周期を変えずにPWM値を変えると、LEDが継続して点灯する時間が変化する。

## 2.キー読み出しで、どのように KEYTRANS を処理したかについて、その理由とともに説明しなさい。

前回KEYTRANSが検出され、今回値が変わった場合も、KEYONやKEYOFFと変わらずキーが新しく押された、または離された判定とした。
理由としては、チャタリングを除去するためである。

## 3. CPUに内蔵されている10ビットのA/D変換器について、変換結果が ADDRAでは図13のように上位ビット側に合わせて入るが、その理由について考察しなさい。

AD変換は、アナログ値を比較し実際の値との誤差を少なくしていく。
そのため、一番大きな桁からビットが確定していく。